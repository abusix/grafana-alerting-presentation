---
# You can also start simply with 'default'
theme: seriph
# random image from a curated Unsplash collection by Anthony
# like them? see https://unsplash.com/collections/94734566/slidev
background: https://cover.sli.dev
# some information about your slides (markdown enabled)
title: Introduction to Grafana alerting
info: |
  ## Slidev Starter Template
  Presentation slides for developers.

  Learn more at [Sli.dev](https://sli.dev)
# apply unocss classes to the current slide
class: text-center
# https://sli.dev/features/drawing
drawings:
  persist: false
# slide transition: https://sli.dev/guide/animations.html#slide-transitions
transition: slide-left
# enable MDC Syntax: https://sli.dev/features/mdc
mdc: true
# take snapshot for each slide in the overview
overviewSnapshots: true
---

# Grafana alerting

A Short Introduction

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<!--
* welcome!
* short introduction to some of the terms and concepts in grafana alerting
* we will be switching between presentation and grafana to get some hands-on views as well
-->

---

# Grafana alerting in a nutshell

* Automatically run *queries* on an interval
* Define *rule* to determine whether alerts should be generated
* Use *policies* to route alerts to appropriate *contact point*
* Use *templates* to format the alert message

---
transition: slide-up
---

# Anatomy of an Alert Rule
## Query(/ies)
* Can be created from existing Panel <br /> *Edit -> Alert -> New alert rule*
* Have a time range and min interval
  * Adjust these based on how you want your alert to behave
  * Set range only as big as needed
* Click `Preview` to show query results

Each time series generated by queries becomes an *alert instance*
* One *alert rule* can monitor conditions for *multiple time series* independently!
* Choose appropriate `GROUP BY`s to make alert more or less selective


<!--
* Setting to a large/different range can be useful to choose appropriate thresholds


* switch to grafana pretty much right away
* https://grafana.abusix.net/d/b5Bbi3K4z/graphql-api?orgId=1&refresh=5s
* Delist checks -> Mean Check Latency
* Manually select `ami_v2` datasource
-->

---
transition: slide-up
---

## Expressions
* Apply some processing to time series/previous expression result
* *Reduce*: Apply function to time series, e.g. max, mean, last
  * Might need to choose different `Mode`
* *Threshold*: Compare result to value/range
* *Math*: Perform arbitrary calculation on expression(s)
  * `$B > 70`
  * `$A - $B`
  * again: applied *to each time series*
  * extremely powerful!
  * not super well documented

<!--
mention alert condition

alert 0 / 1
-->

---
transition: slide-up
---

## Evaluation Behavior
* Folder (for tidiness)
* Evaluation group
  * Decides evaluation interval
* Pending period
  * Delays firing of alert rule
  * Only makes sense if larger than evaluation interval
* No Data handling
  * If query returns no data at all, what should happen?

---
transition: slide-up
---
## Annotations
* Summary and Description
* Can use templating:
  * Evaluated *per alert instance*
  * Access *labels*: <br /> `{{ index $labels "labelName" }}`
    * Determined by query groupBy
  * Access *values*: <br /> `{{ index $values "A" }}`
* Can generate more understandable and actionable message

```
CPU usage for {{ index $labels "instance" }} has exceeded 80% ({{ index $values "A" }}) for the last 5 minutes.
```

---
---
## Labels
* Manually add labels
* Severity of alert, (sub)team, …
* Used to route alerts

---
---
# Policies
* Match on labels
* Specify *contact point*
* Configure *mute timings*
* Other timing options

---
---
# Contact points
* e.g. Slack channel
* Also configure which message and title templates should be used!
  * Different teams can use different message template

---
---
# Notification templates
* Use go template syntax
* Generate message based on list of alerts
* Can access labels, annotations and values
  * Including the summary definitely makes sense
* Can include links to the linked panel, dashboard, alert rule or for generating a silence


* Slack flavoured markup is really annoying…

---
layout: image
image: https://grafana.com/media/docs/alerting/how-notification-templates-works.png
backgroundSize: contain
---

---
---
https://grafana.com/docs/grafana/latest/alerting/
